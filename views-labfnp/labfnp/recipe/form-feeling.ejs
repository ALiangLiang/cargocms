
<% LayoutUtils.addStylesheets('/assets/labfnp/css/chosen/chosen.css'); %>

<style media="screen">
  a.chosen-single.chosen-default {
    background-color: white;
    border-radius: 0px 0px 0px 0px;
    -moz-border-radius: 0px 0px 0px 0px;
    -webkit-border-radius: 0px 0px 0px 0px;
    border: 1px solid #bbb;
    height: 33px;
    background: white;
    margin-bottom: 10px;
    padding-top: 1%;
  }
  .tag {
    background: #7e7c79;
    display: inline-block;
    padding: 3px 7px;
    color: white;
    font-style: normal;
    margin: 3px;
  }
</style>
<header>新香水配方- 感覺</header>
<input type="hidden" name="from" value="<%= from %>" />

<fieldset>
  <section>
    <label class="label">創作者姓名（必填）</label>
    <label class="input">
      <input type="text" name="authorName" placeholder="Enter Name" value="<%= user.username %>" required />
    </label>
  </section>

  <section>
    <label class="label">香水品名（必填）</label>
    <label class="input">
      <input type="text" name="perfumeName" value="<%= recipe.perfumeName %>" placeholder="Enter Perfume Name" required />
    </label>
  </section>

  <section>
    <label class="label">公開狀態</label>
    <label class="select">
      <select name="visibility" class="scents-categories">
        <option <%= recipe.visibility == 'PUBLIC'?'selected':'' %> value="PUBLIC" selected>公開</option>
        <option <%= recipe.visibility == 'PROTECTED'?'selected':'' %> value="PROTECTED">半公開</option>
        <option <%= recipe.visibility == 'PRIVATE'?'selected':'' %> value="PRIVATE">私密</option>
      </select>
      <i></i>
  </section>

  <section>
    <label class="label">香水描述</label>
    <label class="textarea textarea-resizable">
      <textarea name="description" value="<%= recipe.description %>" rows="3"></textarea>
    </label>
  </section>

  <section>
    <label class="label">封面圖片</label>
    <%- include ../../lib/fineuploader.ejs %>
    <div id="fine-uploader-validation"></div>
  </section>

</fieldset>


<!--
<% feelings.forEach(function(feeling) { %>
  <label class="feeling"><%= feeling %></label>
<% }); %>
-->

<fieldset>
  <% recipe.formula.forEach(function(formula, index) { %>
    <div class="row">
      <section class="col col-6">
        <% if (index === 0) { %>
          <label class="label">分類</label>
        <% } %>
        <label class="select">
          <select class="feeling-scents-categories chosen-select" data-placeholder="選擇一種你喜歡的感覺" data-index="<%= formula.index %>">
            <option></option>
            <% feelings.forEach(function(feeling) { %>
              <option value="<%= feeling %>" <%= formula.feelingTitle === feeling?'selected':'' %> ><%= feeling %></option>
            <% }); %>
          </select>
        </label>
      </section>
      <section class="col col-4">
        <% if (index === 0) { %>
          <label class="label">所選之香味分子</label>
        <% } %>
        <label class="select">
          <select name="formulaScents[<%= formula.index %>]" class="scents-dropdown" data-placeholder="選擇一個香味分子" data-index="<%= formula.index %>">
            <option value="">選擇分子</option>
            <% scents.forEach(function(scent) { %>
              <option
                <%= formula.scentName === scent.name ?'selected':'' %>
                value="<%= scent.name %>"
                data-feelings="<%= JSON.stringify(scent.feelings) %>"
                data-color="<%= scent.color %>"
                data-title="<%= scent.title %>"
                data-description="<%= scent.description %>"
                style="display: none;"
              >
                <%= scent.name %>
              </option>
            <% }); %>
          </select>
          <i />
        </label>
      </section>
      <section class="col col-2">
        <% if (index === 0) { %>
          <label class="label">滴數</label>
        <% } %>
        <label class="input">
          <input type="number" name="formulaDrops[<%= formula.index %>]" value="<%= formula.drops %>" class="scents-drops" data-index="<%= formula.index %>">
        </label>
      </section>
    </div>
    <div class="row hidden scent-detail" data-index="<%= formula.index %>">
      <div class="col-md-12">
        <div id="scent-content" class="funny-boxes bg-color-white">
          <h2 id="scent-title">AAA</h2>
          <p id="scent-description">BBB</p>
          <div class="tags" >
          </div>
        </div>
      </div>
    </div>

  <% }); %>
</fieldset>

<fieldset>

  <section>
    <label class="label">備註</label>
    <label class="textarea textarea-resizable">
      <textarea name="message" rows="3"></textarea>
    </label>
  </section>

</fieldset>

<footer>
  <button type="submit" class="btn-u">送出資料</button>
  <button type="button" class="btn-u btn-u-default" onclick="window.history.back();">返回</button>
  <button id="recipeDeleteButton" data-id="<%= recipe.id %>" type="button" class="btn-u btn-u-red pull-right <%= req.options.action== 'edit'?'':'hidden' %>" >刪除</button>
</footer>

<% LayoutUtils.addScripts('/assets/labfnp/lib/chosen/chosen.jquery.min.js'); %>

<% LayoutUtils.addScriptBlock(`
var config = {
  '.chosen-select'           : {allow_single_deselect: true},
}
for (var selector in config) {
  $(selector).chosen(config[selector]);
}
var styles = {
  'background-color': 'white',
  'border-radius': '0px 0px 0px 0px',
  '-moz-border-radius': '0px 0px 0px 0px',
  '-webkit-border-radius': '0px 0px 0px 0px',
  'border': '1px solid #bbb',
  'height': '33px',
  'background': 'white',
  'margin-bottom': '10px',
  'padding-top': '1%',
}
$('.chosen-select').change(function() {
  for (var style in styles) {
    $('a.chosen-single').css(style, styles[style]);
  }
});
$('.feeling-scents-categories').change(function() {
  var idx = $(this).data('index');
  var prefix = $(this).val();
  $('.scent-detail[data-index='+idx+']').addClass("hidden");

  if (prefix) {
    var dropdown = $('.scents-dropdown[data-index='+idx+']');
    dropdown.val("");

    $('option', dropdown)
      .hide()
      .filter(function(index, element) {
        if(index === 0){
          return true;
        }
        var feelings = $(element).data('feelings');
        var visible = false;
        feelings.forEach(function(e) {
          if(e.key === prefix){
            visible = true;
          }
        });
        return visible;
      })
      .show();
  } else {
    $('option', dropdown)
      .hide()
  }
});

// $('option', dropdown)
// .show()
// .filter(function(index, element) { return element.value && element.value.substring(0,1)!==prefix; })
// .hide();

`); %>
