var COMMON = {
  DOUBLE_CLICK_TIME_PERIOD: 250,
  DEFAULT_INDEX: -1,
  DEFAULT_AVATAR: "/assets/admin/img/avatars/default.png",
};

var itemBeforeEdit = {};
var prefix = 'admin/';
var modelName = "jason/product";
var appModel = {
  modelName: modelName,
  prefix: prefix,
  data: {
    item: {
      id: '',
      title: '',
      modelName: '',
      specification: '',
      introduction: '',
      postTitle: '',
      postContent: '',
      postUrl: '',
      postAbstract: '',
      postCoverType: '',
      postCoverUrl: [],
      postCovers: [],
      postType: 'product',
      groupTitle: '',
      groupId: ''
    },
    items: [],
    option: {
      defaultSort: [[ 0, 'desc' ]],
      group: []
    }
  },
  view: {
    table: {
      selectIndex: COMMON.DEFAULT_INDEX,
    },
  }
}

/* TABLETOOLS */

<%- include ../../default/vue.ejs %>
// 需要新增函式可以對 appMain 進行定義，如：
// appMain.log = function () {console.log("123")}
appMain.enableText = function(){
  $("textarea").attr("disabled", false);
  $(".textarea").removeClass('state-disabled');
}
appMain.enableSelect = function () {
  $('select').attr('disabled', false);
  $('.select').removeClass('state-disabled');
}

appMain.getPartGroup = function() {
  var ajaxSuccess = function (result) {
      console.log('get Part group result=>', result);
      appModel.data.option.group = result.data.items;
    } // end ajaxSuccess

  $.get('/api/admin/jason/group/product', ajaxSuccess);
}

appMain.titleOnChange = function() {
  appModel.data.item.postTitle = appModel.data.item.title;
}


appMain.setupImageUpload = function () {
  uploadImageApp.updateModel('itemLimit', 10);
  uploadImageApp.updateModel('onComplete', function(index, name, response){
    console.log(response.data.id, response.data.url);
    console.log(appModel.data.item.postCovers, appModel.data.item.postCoverUrl);
    appModel.data.item.postCovers.push({index: index, id: response.data.id});
    appModel.data.item.postCoverUrl.push(response.data.url);
  })
  uploadImageApp.updateModel('onDeleteComplete', function(index, name, response){
    console.log(index, name, response);
    appModel.data.item.postCovers.forEach((val, i) => {
      if ('index' in val  && val.index === index) {
        appModel.data.item.postCovers.splice(i, 1);
        appModel.data.item.postCoverUrl.splice(i, 1);
      }
    })
  })
  uploadImageApp.setup();
}

appMain.onImageDelete = function(index) {
  console.log(index);
  appModel.data.item.postCovers.splice(index, 1);
  appModel.data.item.postCoverUrl.splice(index, 1);
}
