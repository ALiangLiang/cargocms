var COMMON = {
  DOUBLE_CLICK_TIME_PERIOD: 250,
  DEFAULT_INDEX: -1,
  DEFAULT_AVATAR: "/assets/admin/img/avatars/default.png",
};

var itemBeforeEdit = {};
var prefix = 'admin/';
var modelName = "productimage";
var appModel = {
  modelName: modelName,
  prefix: prefix,
  data: {
    item: {
      id: '',
      image: '',
      ProductId: '',
      ImageId: '',
    },
    items: [],
    option: {
      defaultSort: [[ 0, 'desc' ]],
      productList: [],
    }
  },
  view: {
    table: {
      selectIndex: COMMON.DEFAULT_INDEX,
    },
  }
}

/* TABLETOOLS */

<%- include ../default/vue.ejs %>
// 需要新增函式可以對 appMain 進行定義，如：
// appMain.log = function () {console.log("123")}
appMain.showPageHidden = function(){
  $('.fn-show-hidden').hide();
}

appMain.loadProduct = function () {

  $.get('/api/admin/product', ajaxSuccess);

  function ajaxSuccess(result) {
    if (result.success) {
      appModel.data.option.productList = result.data.items;
    }
  } // end ajaxSuccess
};

appMain.enableText = function () {
  $('textarea').attr('disabled', false);
}

appMain.enableSelect = function () {
	$('select').attr('disabled', false);
	$('.select').removeClass('state-disabled');
}

appMain.setupForm = function (type) {
  var registerForm = $("#main-form");

  if(appModel.data.option.imgUpload){
    var imgUploadSteup = appModel.data.option.imgUpload;
    Object.keys(imgUploadSteup).forEach(function (key) {
       uploadImageApp.updateModel(key, imgUploadSteup[key]);
    });
    uploadImageApp.setup();
  }

  uploadImageApp.updateModel('itemLimit', 1);
  uploadImageApp.updateModel('onComplete', function(id, name, response){
    appMain.data.item.ImageId = response.data.id;
    appMain.data.item.image = response.data.url;
  })
  uploadImageApp.updateModel('onDeleteComplete', function(id, name, response){
    console.log(id, name, response);
    appMain.data.item.ImageId = null;
    appMain.data.item.image = '';
  })
  uploadImageApp.setup();

  registerForm.validate({
    rules: formRules,
    messages: formMessages,
    errorPlacement: function (error, element) {
      error.insertAfter(element.parent());
    },
    submitHandler: function (form) {
      if (type === 'create') {
        appMain.save();
        return false;
      } else if (type === 'edit') {
        appMain.update();
        return false;
      }
    }
  });
}

appMain.customSearch = function(data) {
  appModel.pagingQuery.columns.push({
    data: 'productName',
    searchable: true,
    findInclude: true,
    search: {
      model: 'Product',
      column: 'model',
    }
  });
}